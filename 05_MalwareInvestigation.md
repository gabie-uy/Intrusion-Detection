# Malware Investigation

## Windows Event Logs

Windows Event Logs are complex datasets to work with initially. However, over time you will begin to narrow down the events that are most interesting and useful to your analysis. Below are some of the consistent values found in each Windows Event Log entry:

## üîç Key Fields

- **Event ID**  
  Provides a numerical value to filter specific types of events.  
  _Example:_ Use **Event ID 123** to track **Event XYZ**.

- **Message**  
  A brief description of the event that has been logged.

- **Computer Name**  
  Indicates the name of the system from which the event originated.

- **User**  
  Displays which user generated the event.  
  > ‚ö†Ô∏è If no user is logged in, expect irregular or system-generated input in this field.

---

## Threat Simulation

### üõ°Ô∏è SOC Analyst Post-Incident Report

#### üßæ Incident Summary

Malware is a type of software designed to cause damage to a computer, server, or network. In this investigation, multiple malware variants were identified, each leveraging different evasion and disruption tactics:

- **SILENTTRINITY Powershell Stageless Stager**: Utilizes PowerShell and forces victims to play embedded YouTube audio. It disguises itself using common HTTP headers like `User-Agent`.
- **Orangeworm**: A sophisticated exfiltration-based malware that hides in legitimate-looking packages to avoid detection.
- **Backoff**: A more overt malware causing high connection activity in short intervals, triggering multiple alerts and potential system slowdowns.

#### üîé Indicators of Compromise (IOCs)

| Malware Type     | IOCs Identified                                          |
|------------------|----------------------------------------------------------|
| SILENTTRINITY    | Abnormal PowerShell activity, User-Agent manipulation    |
| Orangeworm       | Unusual HTTP requests and packet lengths, protocol abuse |
| Backoff          | High connection volumes, irregular endpoint communication|

#### üö® Actions Taken

1. **Initial Detection**: Alerts triggered via endpoint monitoring and HTTP behavior anomalies.
2. **Triage & Isolation**: Systems exhibiting high outbound traffic or unusual scripting behavior were isolated.
3. **IOC Correlation**: Compared across logs to identify infection spread and pivot activity.
4. **Malware Removal**: Re-imaging and removal of affected hosts using endpoint protection tools.
5. **Traffic Analysis**: Inspected HTTP and protocol ladders to determine C2 communication.

#### üß† Root Cause Analysis

- **SILENTTRINITY**: Delivered via malicious scripts or phishing links; used embedded media to confirm execution.
- **Orangeworm**: Embedded in trojanized software packages. Evaded detection due to exfiltration-focused stealth.
- **Backoff**: Likely introduced through weak remote access protocols; detected due to heavy outbound C2 communication.

#### üìö Lessons Learned

- Adversaries are increasingly blending techniques to obscure intent (e.g., Orangeworm + Exfiltration).
- Malware with high traffic signatures (e.g., Backoff) are easier to detect but may be symptomatic of deeper issues.
- Legitimate network behavior baselining is crucial to differentiate threats from regular traffic.

#### ‚úÖ Recommendations

- Implement network behavior analysis tools and continuous monitoring.
- Enforce strict PowerShell execution policies and script logging.
- Regularly update antivirus/malware signatures and endpoint protection agents.
- Conduct phishing simulation training and awareness across all departments.
- Utilize sandbox environments to test unknown packages or binaries.

### üìä Criticality Assessment

| Threat Name                | Criticality | Reasoning |
|---------------------------|-------------|-----------|
| **Backoff**               | üî¥ High     | High connection count, easier to detect, but disrupts productivity and exposes endpoints. |
| **Orangeworm**            | üü† Medium   | Harder to detect, but moves slowly. Exfiltration risk is high if not spotted early. |
| **SILENTTRINITY Stager**  | üü° Low      | Trickier payload, but less damaging long-term unless leveraged for secondary access.|

---

## üìå What Does the Enterprise Do Next?

### üîÅ Synthesize the Investigation and Its Implications

- Cross-reference IOCs across departments to identify lateral movement.
- Alert internal stakeholders to increased threat activity and educate technical teams on evasion trends.

### üõ†Ô∏è Remediation Plan

- Deploy enhanced detection rules (YARA/Sigma) to identify PowerShell-based threats.
- Review all RDP/remote access configurations to prevent Backoff-like intrusions.
- Patch vulnerable software to avoid malware-laden packages reaching systems.

### üìà Business Implications

#### Short-Term:
- Temporary system outages and reduced productivity.
- Increased incident response and IT workload.
- Customer dissatisfaction due to disrupted services.

#### Long-Term:
- Loss of customer trust if data exfiltration occurred.
- Regulatory and legal risks from data privacy breaches.
- Financial impact from downtime, fines, or lawsuits.

---

## üì∏ Figures

### SILENTTRINITY Powershell Stageless Stager

#### Figure 1.0 ‚Äì HTTP Protocol containing ‚ÄúUser-Agent‚Äù
![Figure 1.0](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/d17655ee-31c7-4921-9335-a7f14beb9710)

#### Figure 1.1 ‚Äì Threat Assessment Summary
![Figure 1.1](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/498646af-4384-4906-b71f-859c4be2e9f5)

#### Figure 1.2 ‚Äì Alert Table
![Figure 1.2](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/9e4b72cc-f061-45ce-9ffd-3969c2124b22)

#### Figure 1.3 ‚Äì Threat Vector
![Figure 1.3](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/674c6eaa-1452-4c14-aa09-5d548f8e102d)

---

### Orangeworm

#### Figure 2.0 ‚Äì HTTP
![Figure 2.0](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/695e74cc-62f6-419d-b19f-0c7ce01aaad1)

#### Figure 2.1 ‚Äì Packet Lengths
![Figure 2.1](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/fce914de-5489-446a-9e0d-0058ef047ec1)

#### Figure 2.2 ‚Äì HTTP Requests
![Figure 2.2](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/453cf34d-7cb3-4439-b484-15991618c610)

#### Figure 2.3 ‚Äì HTTP Requests
![Figure 2.3](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/be8df497-f4e4-4560-b11e-3577e635e90d)

#### Figure 2.4 ‚Äì Protocol Ladder
![Figure 2.4](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/6d3189e2-5f5e-4041-9bec-8b917eb6cb97)

---

### Backoff

#### Figure 3.0 ‚Äì Threat Summary
![Figure 3.0](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/96c9dac9-7440-4b4f-8bed-9248018cd8b2)

#### Figure 3.2 ‚Äì Threat Vector
![Figure 3.2](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/f83f17b2-1b6e-4ae3-b505-9af8377a37aa)

#### Figure 3.3 ‚Äì Alert Table
![Figure 3.3](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/afeb6c71-8106-4b1d-ab06-22ed0d86ecf3)

#### Figure 3.4 ‚Äì HTTP Analysis
![Figure 3.4](https://github.com/gabizzle/Intrusion-Detection/assets/67624149/dcd8f591-3f1c-4bc3-b9de-ae14171d20ec)

---

## References
- https://www.activecountermeasures.com/malware-of-the-day-backoff/
- https://www.activecountermeasures.com/malware-of-the-day-orangeworm/
- https://www.activecountermeasures.com/malware-of-the-day-malware-techniques-data-exfiltration-or-forcing-a-host-to-play-thunderstruck-as-loud-as-possible/
- https://attack.mitre.org/tactics/TA0010/ 
